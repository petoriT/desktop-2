{"version":3,"sources":["./src/app/modules/admin-store/pages/payment/payment.page.html","./src/app/modules/admin-store/pages/payment/payment-routing.module.ts","./src/app/modules/admin-store/pages/payment/payment.module.ts","./src/app/modules/admin-store/pages/payment/payment.page.scss","./src/app/modules/admin-store/pages/payment/payment.page.ts"],"names":[],"mappings":"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","file":"modules-admin-store-pages-payment-payment-module.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>payment</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <form\\n  #form\\n  action=\\\"https://sandbox.payfast.co.za/eng/process\\\"\\n  method=\\\"POST\\\"\\n  >\\n  <!-- Merchant details -->\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"merchant_id\\\"\\n    value=\\\"{{payfastForm.merchant_id}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"merchant_key\\\"\\n    value=\\\"{{payfastForm.merchant_key}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"return_url\\\"\\n    value=\\\"{{payfastForm.return_url}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"cancel_url\\\"\\n    value=\\\"{{payfastForm.cancel_url}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"notify_url\\\"\\n    value=\\\"{{payfastForm.notify_url}}\\\"\\n  />\\n  \\n  <!-- Buyer Details -->\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"email_address\\\"\\n    value=\\\"{{payfastForm.buyer_email}}\\\"\\n  />\\n  \\n  <!-- Transaction Details -->\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"m_payment_id\\\"\\n    value=\\\"{{payfastForm.m_payment_id}}\\\"\\n  />\\n  <input type=\\\"hidden\\\" name=\\\"amount\\\" value=\\\"{{payfastForm.amount}}\\\" />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"item_name\\\"\\n    value=\\\"{{payfastForm.item_name}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"item_description\\\"\\n    value=\\\"{{payfastForm.item_description}}\\\"\\n  />\\n  \\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"email_confirmation\\\"\\n    value=\\\"{{payfastForm.email_confirmation}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"confirmation_address\\\"\\n    value=\\\"{{payfastForm.confirmation_address}}\\\"\\n  />\\n  \\n  <!-- Set Payment Method -->\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"payment_method\\\"\\n    value=\\\"{{payfastForm.payment_method}}\\\"\\n  />\\n  <input\\n    type=\\\"hidden\\\"\\n    name=\\\"signature\\\"\\n    value=\\\"{{payfastForm.signature}}\\\"\\n  />\\n  \\n  <ion-button   (click)=\\\" onSub(payfastForm); form.submit()\\\"   *ngIf=\\\"billing_cycle_selected == 'yearly'\\\" expand=\\\"block\\\" shape=\\\"round\\\">\\n    {{selected_license.annual_price | currency: 'R' }} PayFast <ion-icon name=\\\"card-outline\\\"></ion-icon>\\n  </ion-button>\\n  <ion-button   (click)=\\\" onSub(payfastForm); form.submit()\\\"  *ngIf=\\\"billing_cycle_selected == 'mon'\\\" expand=\\\"block\\\" shape=\\\"round\\\">\\n    {{selected_license.monthly_price | currency: 'R' }} PayFast <ion-icon name=\\\"card-outline\\\"></ion-icon>\\n  </ion-button>\\n  \\n  </form>\\n  \\n</ion-content>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PaymentPage } from './payment.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PaymentPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PaymentPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PaymentPageRoutingModule } from './payment-routing.module';\n\nimport { PaymentPage } from './payment.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PaymentPageRoutingModule\n  ],\n  declarations: [PaymentPage]\n})\nexport class PaymentPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL21vZHVsZXMvYWRtaW4tc3RvcmUvcGFnZXMvcGF5bWVudC9wYXltZW50LnBhZ2Uuc2NzcyJ9 */\";","import { Component, OnInit, OnChanges } from '@angular/core';\r\nimport { PayfastFacadeService } from \"src/app/core-modules/services/payments/payfast-facade/payfast-facade.service\";\r\nimport { ProfileApiService } from 'src/app/core-modules/services/profile/profile-api/profile-api.service';\r\nimport { Md5 } from \"ts-md5/dist/md5\";\r\n\r\n@Component({\r\n  selector: 'app-payment',\r\n  templateUrl: './payment.page.html',\r\n  styleUrls: ['./payment.page.scss'],\r\n})\r\nexport class PaymentPage implements OnInit, OnChanges {\r\n  md5 = new Md5();\r\n  user_email\r\n  payfastForm;\r\n  selected_license\r\n  billing_cycle_selected\r\n  constructor(\r\n    private payFacade: PayfastFacadeService,\r\n    private userApi: ProfileApiService,\r\n  ) { }\r\n  ngOnChanges(){\r\n    console.log(this.payfastForm)\r\n  }\r\n\r\n  ngOnInit() {\r\n    let state = window.history.state\r\n    this.user_email = state.user_email\r\n    this.selected_license = {...state.selected_license}\r\n    this.billing_cycle_selected = state.billing_cycle_selected\r\n    this.payFast()\r\n    console.log(this.payfastForm)\r\n  }\r\n\r\n  //Send form to payfast\r\n  onSub(info) {\r\n    localStorage.removeItem(\"license_name\")\r\n    let license = this.selected_license;  \r\n    this.payFacade.temporaryOrder(info, license);\r\n  }\r\n\r\n  payFast() {\r\n    if(this.selected_license){\r\n      let payfastForm: any = {};\r\n        // Merchant details\r\n        payfastForm.merchant_id = \"10016542\";\r\n        payfastForm.merchant_key = \"w7wn35bsap1pf\";\r\n        payfastForm.return_url =\r\n          \"https://cartalist.herokuapp.com/buy/payment/checkout/payfast/success\";\r\n        payfastForm.cancel_url =\r\n          \"https://cartalist.herokuapp.com/buy/payment/checkout/payfast/cancel\";\r\n        payfastForm.notify_url = \"https://cartalist.herokuapp.com/api/payfast/notify_url\";\r\n\r\n        // Buyer Details\r\n        payfastForm.buyer_email = this.user_email;\r\n\r\n        // Transaction Details\r\n        payfastForm.m_payment_id = this.randomize();\r\n        payfastForm.amount = this.selected_license.payed_amount.amount.toFixed(2);\r\n        payfastForm.item_name = \"Lisence\";\r\n        payfastForm.item_description = this.selected_license.license_name;\r\n        payfastForm.email_confirmation = \"1\";\r\n        payfastForm.confirmation_address = this.user_email;\r\n\r\n        // Set Payment Method\r\n        payfastForm.payment_method = \"eft\";\r\n        \r\n        let hash = `merchant_id=${encodeURIComponent(\r\n          payfastForm.merchant_id\r\n        )}&merchant_key=${encodeURIComponent(\r\n          payfastForm.merchant_key\r\n        )}&return_url=${encodeURIComponent(\r\n          payfastForm.return_url\r\n        )}&cancel_url=${encodeURIComponent(\r\n          payfastForm.cancel_url\r\n        )}&notify_url=${encodeURIComponent(\r\n          payfastForm.notify_url\r\n        )}&email_address=${encodeURIComponent(\r\n          payfastForm.buyer_email\r\n        )}&m_payment_id=${encodeURIComponent(\r\n          payfastForm.m_payment_id\r\n        )}&amount=${encodeURIComponent(\r\n          payfastForm.amount\r\n        )}&item_name=${encodeURI(\r\n          payfastForm.item_name\r\n        )}&item_description=${encodeURI(\r\n          payfastForm.item_description\r\n        )}&email_confirmation=${encodeURIComponent(\r\n          payfastForm.email_confirmation\r\n        )}&confirmation_address=${encodeURIComponent(\r\n          payfastForm.confirmation_address\r\n        )}&payment_method=${encodeURIComponent(payfastForm.payment_method)}`;\r\n    \r\n        // MD5 encode\r\n        \r\n        payfastForm.signature = this.md5.appendStr(hash).end();\r\n        \r\n        this.payfastForm = payfastForm\r\n        \r\n      \r\n        console.log(payfastForm,this.payfastForm)\r\n    }\r\n    \r\n    \r\n  }\r\n\r\n  randomize() {\r\n    // Randomize chars\r\n    let length = 10;\r\n    let chars =\r\n      \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n    var result = \"\";\r\n    for (var i = length; i > 0; --i)\r\n      result += chars[Math.floor(Math.random() * chars.length)];\r\n    return result;\r\n  }\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}