<div *ngIf="no_product">
  <ion-grid>
    <ion-row style="height: 70vh" class="center">
      <ion-col size="12">
        <ion-label> No Products </ion-label>
      </ion-col>
      <ion-col size="12">
        <ion-button (click)="sendToParent()" shape="round"
          >Add A product <ion-icon name="add-circle-outline"></ion-icon
        ></ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>
<div *ngIf="!no_product">
  <div *ngIf="device_screen == 'Handset'">
    <mat-accordion>
      <ion-toolbar>
        <ion-grid>
          <ion-row>
            <ion-col class="center" size="4.8"> </ion-col>
            <ion-col class="center" size="2"> </ion-col>
            <ion-col class="center" size="1.4"> </ion-col>
            <ion-col class="center" size="1.3"> </ion-col>
            <ion-col class="center" size="2.5">
              <ion-label><sub style="text-align: left">PRICE</sub></ion-label>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-toolbar>
      <ion-scroll scrollY="true">
        <mat-expansion-panel
          (click)="expanded(product)"
          [disabled]="clickButton"
          (click)="clickButton = false"
          hideToggle
          *ngFor="let product of products$ | async; let i = index"
        >
          <mat-expansion-panel-header
            [collapsedHeight]="'12vh'"
            style="padding: 0px"
          >
            <ion-item-sliding>
              <ion-item lines="none" style="--inner-padding-end: 0px">
                <ion-grid>
                  <ion-row>
                    <ion-col class="center" size="2">
                      <ion-avatar style="height: 13vw; width: auto">
                        <img src="{{ product.productImage[0].url }}" />
                      </ion-avatar>
                    </ion-col>
                    <ion-col class="center" size="7">
                      <ion-label
                        #name
                        style="text-align: center"
                        value="product.productName"
                        ><sub>{{ product.productName }}</sub></ion-label
                      >
                    </ion-col>
                    <ion-col class="center" size="3">
                      <ion-label #price
                        ><sub
                          >{{ product.productPrice | currency: "R" }}
                        </sub></ion-label
                      >
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-item>
  
              <ion-item-options>
                <ion-item-option color="light">
                  <ion-button
                    *ngIf="!edit"
                    shape="round"
                    fill="solid"
                    (click)="editProduct()"
                    size="small"
                    color="primary"
                  >
                    <ion-icon
                      size="small"
                      slot="icon-only"
                      name="create"
                    ></ion-icon>
                  </ion-button>
                  <ion-button
                    *ngIf="edit"
                    [disabled]="updateProduct.invalid"
                    shape="round"
                    type="submit"
                    fill="solid"
                    (click)="update()"
                    size="small"
                    color="primary"
                  >
                    <ion-icon
                      size="small"
                      slot="icon-only"
                      name="save-outline"
                    ></ion-icon>
                  </ion-button>
                </ion-item-option>
                <ion-item-option color="light">
                  <ion-button
                    shape="round"
                    (click)="onDeleteProduct(product)"
                    size="small"
                    color="danger"
                  >
                    <ion-icon
                      fill="solid"
                      size="small"
                      slot="icon-only"
                      name="trash"
                    ></ion-icon>
                  </ion-button>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </mat-expansion-panel-header>
  
          <div matExpansionPanelContent>
            <form [formGroup]="updateProduct">
              <ion-grid>
                <ion-row>
                  <ion-col size="8">
                    <ion-item>
                      <ion-label position="floating">Product Name:</ion-label>
                      <ion-input
                        formControlName="productName"
                        [attr.disabled]="!edit"
                        value="{{ product.productName }}"
                        position="floating"
                      >
                      </ion-input>
                      <div
                        *ngIf="
                          updateProduct.get('productName').invalid &&
                          updateProduct.get('productName').touched
                        "
                      >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productName').errors?.required
                          "
                          color="danger"
                          ><sub>Product name is required</sub></ion-text
                        >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productName').errors?.minlength
                          "
                          color="danger"
                          ><sub
                            >Product name must be at least 2 Characters</sub
                          ></ion-text
                        >
                      </div>
                    </ion-item>
                  </ion-col>
                  <ion-col size="4">
                    <ion-item>
                      <ion-label position="floating">Price</ion-label>
                      <ion-input
                        formControlName="productPrice"
                        [attr.disabled]="!edit"
                        value="{{ product.productPrice }}"
                      ></ion-input>
                    </ion-item>
                  </ion-col>
  
                  <ion-col size="12" class="center">
                    <ion-item>
                      <ion-label position="floating">Description</ion-label>
                      <!--todo: enable edit inputs-->
                      <ion-textarea
                        style="font-size: 12px"
                        formControlName="productDescription"
                        value="{{ product.productDescription }}"
                        [attr.disabled]="!edit"
                        type="text"
                      ></ion-textarea>
                      <div
                        *ngIf="
                          updateProduct.get('productDescription').invalid &&
                          updateProduct.get('productDescription').touched
                        "
                      >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productDescription').errors
                              ?.required
                          "
                          color="danger"
                          ><sub>Description is required</sub></ion-text
                        >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productDescription').errors
                              ?.minlength
                          "
                          color="danger"
                          ><sub
                            >Description must be at least 5 Characters</sub
                          ></ion-text
                        >
                      </div>
                    </ion-item>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col class="center" size="12">
                    <ion-row>
                      <ion-col size="12">
                        <ion-label position="floating">category</ion-label>
                        <ion-select
                          formControlName="selectCategory"
                          [attr.disabled]="!edit"
                          value="{{ product.category }}"
                        >
                          <ion-item
                            class=""
                            *ngFor="
                              let category of categories$ | async;
                              let i = index
                            "
                          >
                            <ion-select-option
                              value="{{ category.categoryName }}"
                              >{{ category.categoryName }}</ion-select-option
                            >
                          </ion-item>
                        </ion-select>
                      </ion-col>
                    </ion-row>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col
                    class="center"
                    style="background-color: #f1f3f6"
                    size="12"
                  >
                    <!--<ion-grid>
                      <ion-row>
                        <ion-col size="12">
                       
  
                          <ion-item >
                          <div *ngFor="let image of product.productImage">
                            <ion-avatar  style="height: 13vw; width: auto;">
                              <img src="{{ image.url }}" >
                            </ion-avatar>
                          </div>
                          </ion-item>
  
  
                        </ion-col>
                        <ion-col size="12">
                          <ion-button
                            size="small"
                            shape="round"
                            (click)="uploadImage()"
                            ><sub>Upload Image</sub>
                            <ion-input
                            style="z-index: 10;
                            position: absolute;
                            width: 101px;
                            opacity: 0;"
                            [attr.disabled]="!edit"
                            type="file"
                            multiple
                            (change)="handleFileInput($event)"
                          ></ion-input>
  
                            </ion-button
                          >
                        </ion-col>
                      </ion-row>
                    </ion-grid>-->
                    <div *ngFor="let image of product.productImage">
                      <ion-avatar
                        style="
                          border: groove;
                          width: 30vw;
                          height: 30vw;
                          display: inline-block;
                          float: left;
                        "
                      >
                        <ion-img
                          (click)="viewImageOptions(image, product)"
                          picture_uploaded
                          src="{{ image.url }}"
                        >
                        </ion-img>
                      </ion-avatar>
                    </div>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col class="center" size="12">
                    <div *ngFor="let metaTag of product.metaTags">
                      <ion-chip>
                        <ion-label>{{ metaTag.metaTagname }}</ion-label>
                        <ion-icon name="close-circle"></ion-icon>
                      </ion-chip>
                    </div>
                    <ion-chip>
                      <ion-icon (click)="addMetaTag()" name="add-circle-outline">
                        <!--TODO: Add metatag-->
                      </ion-icon>
                    </ion-chip>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </form>
          </div>
        </mat-expansion-panel>
      </ion-scroll>
    </mat-accordion>
  </div>
  <div *ngIf="device_screen =='Web'">
    <ion-grid>
      <ion-row>
        <ion-col size=8>
            <ion-item style=" --background: #f6f6f6;" >
              <ion-grid>
                <ion-row>
                  <ion-col class="center" size="1"> </ion-col>
                  <ion-col class="center" size="2"> </ion-col>
                  <ion-col class="center" size="6">  <ion-label><sub>PRODUCT NAME </sub></ion-label></ion-col>
           
                  <ion-col class="center" size="3">
                    <ion-label><sub> PRICE </sub></ion-label>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size=12>
                    <div class="head_fade"> 

                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>
            <ion-content class="content_area" style="overflow: scroll;height: 75vh;"  scroll="true">
                
              <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
                <ion-refresher-content></ion-refresher-content>
              </ion-refresher>

              <ion-list style="padding-bottom: 120px;">
                <ion-item-sliding *ngFor="let product of products$ | async; let i = index"  #slidingItem>
                  
                  <ion-item [ngClass]="{'active_product': detail_view_product == product }"   href="javascript:void(0)" #item  (click)="setDesktopProductView(product) " lines="full" style="--inner-padding-end: 0px">
                    <ion-grid>
                      <ion-row>
                        <ion-col class="center" size="1">
                          <ion-chip class="center" style="height: 24px;
                          width: 24px;">
                            <sub> {{i+1}} </sub>
                          </ion-chip>
                        </ion-col>
                    
                        <ion-col class="center" size="2">
                          <ion-avatar style=" height: 64px; width: 64px;">
                            <img src="{{ product.productImage[0].url }}" />
                          </ion-avatar>
                        </ion-col>
                        <ion-col class="center" size="6">
                          <ion-label
                            #name
                            style="text-align: center"
                            value="product.productName"
                            ><sub>{{ product.productName }}</sub></ion-label
                          >
                        </ion-col>
                        <ion-col class="center" size="3">
                          <ion-label #price
                            ><sub
                              >{{ product.productPrice | currency: "R" }}
                            </sub></ion-label
                          >
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                    
                  </ion-item>
      
                  <ion-item-options>
                    <ion-item-option color="light">
                      <ion-button
                        *ngIf="!edit"
                        shape="round"
                        fill="solid"
                        (click)="editProduct()"
                        size="small"
                        color="primary"
                      >
                        <ion-icon
                          size="small"
                          slot="icon-only"
                          name="create"
                        ></ion-icon>
                      </ion-button>
                      <ion-button
                        *ngIf="edit"
                        [disabled]="updateProduct.invalid"
                        shape="round"
                        type="submit"
                        fill="solid"
                        (click)="update()"
                        size="small"
                        color="primary"
                      >
                        <ion-icon
                          size="small"
                          slot="icon-only"
                          name="save-outline"
                        ></ion-icon>
                      </ion-button>
                    </ion-item-option>
                    <ion-item-option color="light">
                      <ion-button
                        shape="round"
                        (click)="onDeleteProduct(product)"
                        size="small"
                        color="danger"
                      >
                        <ion-icon
                          fill="solid"
                          size="small"
                          slot="icon-only"
                          name="trash"
                        ></ion-icon>
                      </ion-button>
                    </ion-item-option>
                  </ion-item-options>
                </ion-item-sliding>
               </ion-list>
               


            
              </ion-content>
        </ion-col>
        <ion-col   size=4>
        <ion-content style="--background: #f6f6f6;height: 80vh;">
          <ion-card color="light" *ngIf="detail_view_product" style="box-shadow: none;margin-bottom: 100px" >
            <form [formGroup]="updateProduct">
              <ion-grid>
                <ion-row>
                  <ion-col style="height: fit-content;" size=12>
                    <ion-slides style="height: 45vh;">
                      <ion-slide style="width:100% !important" *ngFor="let image of detail_view_product.productImage">
                          <ion-img
                          style="width: 100%;"
                            (click)="viewImageOptions(image, product)"
                            picture_uploaded
                            src="{{ image.url }}"
                          >
                          </ion-img>
                      
                            <ion-fab style="left:0;bottom: 0;" >
                              <ion-fab-button
                              *ngIf="!edit"
                              shape="round"
                              fill="solid"
                              (click)="editProduct()"
                              size="small"
                        
                            >
                              <ion-icon
                                size="small"
                           
                                name="create"
                              ></ion-icon>
                            </ion-fab-button>
                            <ion-fab-button
                              *ngIf="edit"
                              [disabled]="updateProduct.invalid"
                              shape="round"
                              type="submit"
                              fill="solid"
                              (click)="update()"
                              size="small"
                    
                            >
                              <ion-icon
                                name="save"
                              ></ion-icon>
                            </ion-fab-button>
                            </ion-fab>
                            <ion-fab style="bottom: 0;right:0">
                              <ion-fab-button
                              shape="round"
                              (click)="onDeleteProduct(product)"
                              size="small"
                              color="danger"
                            >
                              <ion-icon
                                fill="solid"
                             
                                name="trash"
                               
                              ></ion-icon>
                            </ion-fab-button>
                            </ion-fab>
                         
                        </ion-slide>
                    </ion-slides>
               

                    <ion-item color="light" class="desktop_item" >
                      <div *ngFor="let metaTag of detail_view_product.metaTags">
                        <ion-chip>
                          <ion-label>{{ metaTag.metaTagname }}</ion-label>
                          <ion-icon name="close-circle"></ion-icon>
                        </ion-chip>
                      </div>
                      <ion-chip>
                        <ion-icon (click)="addMetaTag()" name="add-circle-outline">
                          <!--TODO: Add metatag-->
                        </ion-icon>
                      </ion-chip>
                    </ion-item>
                    <ion-item color="light" >
                      <ion-label position="floating">Product Name:</ion-label>
                      <ion-input
                        formControlName="productName"
                        [attr.disabled]="!edit"
                        value="{{detail_view_product.productName }}"
                        position="floating"
                      >
                      </ion-input>
                      <div
                        *ngIf="
                          updateProduct.get('productName').invalid &&
                          updateProduct.get('productName').touched
                        "
                      >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productName').errors?.required
                          "
                          color="danger"
                          ><sub>Product name is required</sub></ion-text
                        >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productName').errors?.minlength
                          "
                          color="danger"
                          ><sub
                            >Product name must be at least 2 Characters</sub
                          ></ion-text
                        >
                      </div>
                    </ion-item>
           
                    <ion-item color="light">
                      <ion-label position="floating">Price</ion-label>
                      <ion-input
                        formControlName="productPrice"
                        [attr.disabled]="!edit"
                        value="{{ detail_view_product.productPrice }}"
                      ></ion-input>
                    </ion-item>
                  </ion-col>
                  <ion-col size=12>
                  
                      <ion-label position="floating">Description</ion-label>
                      <!--todo: enable edit inputs-->
                      <ion-textarea
                        autosize [(ngModel)]="text"
                        style="font-size: 12px;padding-bottom: 120px"
                        formControlName="productDescription"
                        value="{{ detail_view_product.productDescription }}"
                        [attr.disabled]="!edit"
                        type="text"
                      ></ion-textarea>
                      <div
                        *ngIf="
                          updateProduct.get('productDescription').invalid &&
                          updateProduct.get('productDescription').touched
                        "
                      >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productDescription').errors
                              ?.required
                          "
                          color="danger"
                          ><sub>Description is required</sub></ion-text
                        >
                        <ion-text
                          *ngIf="
                            updateProduct.get('productDescription').errors
                              ?.minlength
                          "
                          color="danger"
                          ><sub
                            >Description must be at least 5 Characters</sub
                          ></ion-text
                        >
                      </div>
                   
                  </ion-col>
              
                </ion-row>
            
              
                    <!--<ion-grid>
                      <ion-row>
                        <ion-col size="12">
                       
  
                          <ion-item >
                          <div *ngFor="let image of product.productImage">
                            <ion-avatar  style="height: 13vw; width: auto;">
                              <img src="{{ image.url }}" >
                            </ion-avatar>
                          </div>
                          </ion-item>
  
  
                        </ion-col>
                        <ion-col size="12">
                          <ion-button
                            size="small"
                            shape="round"
                            (click)="uploadImage()"
                            ><sub>Upload Image</sub>
                            <ion-input
                            style="z-index: 10;
                            position: absolute;
                            width: 101px;
                            opacity: 0;"
                            [attr.disabled]="!edit"
                            type="file"
                            multiple
                            (change)="handleFileInput($event)"
                          ></ion-input>
  
                            </ion-button
                          >
                        </ion-col>
                      </ion-row>
                    </ion-grid>-->
              
               
              </ion-grid>
            </form>


          </ion-card>
        </ion-content> 
        </ion-col>
      </ion-row>
    </ion-grid>
    
  </div>
</div>
